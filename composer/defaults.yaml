# -*- coding: utf-8 -*-

# Default variables for the Composer LTS 4.9 release deployment

composer:
  # Constants
  prefix: '/opt/composer'
  config_dir: '/etc/composer'
  user: composer
  group: composer

  # Defaults which could be overridden in Pillar
  base_url: 'https://composer-repo.logianalytics.com'
  gpgkey: 'https://composer-repo.logianalytics.com/ZOOMDATA-GPG-KEY.pub'
  release: '6.8'
  repositories:
    - tools
  components:
    - stable
    #- unstable

  bootstrap: False
  enforce: True
  erase: False

  #version: 'latest'
  packages:
    - composer
    - composer-query-engine
    #- composer-admin-server
    #- composer-config-server

  edc:
    #version: 'latest'
    packages:
      - composer-edc-apache-solr
      - composer-edc-cloudera-search
      - composer-edc-elasticsearch-6.0
      - composer-edc-elasticsearch-7.0
      - composer-edc-hive
      - composer-edc-impala
      - composer-edc-memsql
      - composer-edc-mongo
      - composer-edc-mssql
      - composer-edc-mysql
      - composer-edc-oracle
      - composer-edc-phoenix-4.7-queryserver
      - composer-edc-postgresql
      - composer-edc-redshift
      - composer-edc-rts
      - composer-edc-sparksql

    jdbc:
      drivers: {}
      install: False

    probe:
      timeout: Null
      path: 'actuator/health'

  microservices:
    #version: 'latest'
    packages:
      - composer-consul
      - composer-data-writer-postgresql
      - composer-screenshot-service
      #- composer-tracing-server

  tools:
    packages:
      - composer-zdmanage

  # Comment added to each file modified by the formula
  header: |
    ################################################################################
    ### ATTENTION! WARNING! Managed by Salt (infrastructure automation software) ###
    ### PLEASE DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES MAY BE OVERWRITTEN! ###
    ################################################################################

  limits: {}

  environment: {}

  config:
    composer:
      path: /etc/composer/composer.properties
      properties:
        spring.datasource.url: 'jdbc:postgresql://localhost:5432/composer'
        spring.datasource.username: composer
        spring.datasource.password: 'PleaseChangeMe'
        keyset.destination.params.jdbc_url: 'jdbc:postgresql://localhost:5432/composer-keyset'
        keyset.destination.params.user_name: 'composer'
        keyset.destination.params.password: 'PleaseChangeMe'
        keyset.destination.schema: 'public'
        upload.destination.params.jdbc_url: 'jdbc:postgresql://localhost:5432/composer-upload'
        upload.destination.params.user_name: 'composer'
        upload.destination.params.password: 'PleaseChangeMe'
        upload.destination.schema: 'public'
        upload.batch-size: 1000
        server.port: 8080
        server.servlet.context-path: /composer
      merge: True
      update: False
      discard: True
    composer-consul:
      path: '/etc/composer/consul.json'
      json: {}
    composer-query-engine:
      path: '/etc/composer/query-engine.properties'
      properties:
        spring.qe.datasource.jdbcUrl: 'jdbc:postgresql://localhost:5432/composer-qe'
        spring.qe.datasource.username: 'composer'
        spring.qe.datasource.password: 'PleaseChangeMe'
      merge: True
      update: False
      discard: True

  post_install: {}

  services:
    - composer-consul
    - composer-edc-apache-solr
    - composer-edc-cloudera-search
    - composer-edc-elasticsearch-6.0
    - composer-edc-elasticsearch-7.0
    - composer-edc-hive
    - composer-edc-impala
    #- composer-edc-memsql
    - composer-edc-mongo
    #- composer-edc-mssql
    #- composer-edc-mysql
    #- composer-edc-oracle
    - composer-edc-phoenix-4.7-queryserver
    - composer-edc-postgresql
    #- composer-edc-redshift
    - composer-edc-rts
    - composer-edc-sparksql
    - composer-data-writer-postgresql
    #- composer-screenshot-service
    - composer-query-engine
    - composer

  setup:
    # This is supported starting from Composer 4.0 release
    probe: 'api/version'
    timeout: 900
    # Composer API V2 URI path without context path
    api: api
    # Composer API V2 default headers
    headers:
      Accept: '*/*'
      Content-Type: 'application/vnd.composer.v2+json'
    init:
      username: admin
      password: admin
    passwords: {}
    branding: {}
    connectors: {}
    toggles: {}

  backup:
    services: []
    databases: []
    state: Null
    destination: /opt/composer/data/backups
    strptime: '%y-%m-%d_%H:%M:%S'
    retention: Null
    bin: pg_dump --no-password --clean --if-exists --create
    compressor: gzip
    comp_opts: ''
    comp_ext: '_postgre.sql.gz'

  restore:
    bin: psql
    user: postgres
    dir: Null
