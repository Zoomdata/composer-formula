# -*- coding: utf-8 -*-
# vim: ft=sls

{% import_yaml 'composer/defaults.yaml' as defaults %}

{% set composer = defaults.composer %}

default: {{ composer|yaml }}

Debian:
  {% if grains['os'] == 'Ubuntu' %}
  os: {{ grains['oscodename'] }}
  {% elif 'systemd' in salt['grains.ls']() %}
  # Configure Unbuntu 16.04 LTS repo on other 
  # Debian derivatives with systemd available
  os: xenial
  {%- endif %}
  # The repo contains only Ubuntu directory
  os_type: ubuntu
  repo_type: 'apt'
  repo_name: 'composer-%(repo)s-repo'
  repo_file: '/etc/apt/sources.list.d/composer-%(repo)s.list'
  repo_entry: 'deb %(base_url)s/%(repo)s/%(repo_type)s/%(os_type)s %(os)s
               %(components)s'
  repo_keyfile: {{ salt['file.join'](composer.config_dir,
                                     salt['file.basename'](composer.gpgkey)) }}

RedHat:
  os_type: {{ grains['os_family']|lower }}
  os_release: {{ grains['osmajorrelease'] }}
  os_arch: {{  grains['osarch'] }}
  repo_type: 'yum'
  repo_name: 'composer-%(repo)s-%(component)s'
  repo_desc: 'Logi Composer %(repo)s %(component)s RPMs'
  repo_url: '%(base_url)s/%(repo)s/%(repo_type)s/%(os_type)s/%(os_release)s/%(os_arch)s/%(component)s'
